language: objective-c
osx_image: xcode10.2
stages:
- name: test
- name: deploy
  if: repo = meniga/mobile-sdk-ios AND type = push AND branch =~ release/*
jobs:
  include:
  - stage: test
    script:
    - bundle exec fastlane tests
    after_success:
    - bash <(curl -s https://codecov.io/bash)
  - stage: deploy
    name: Release podspec
    install:
    - git fetch --unshallow --tags
    - git checkout $TRAVIS_BRANCH
    - bundle install
    script:
    - |
      bundle exec fastlane ci_deploy \
      gh_user:MenigaBuildsson \
      gh_user_email:mobile.dev@meniga.com \
      gh_token:$GH_TOKEN
env:
  global:
  - secure: gVYxZRYgL5KQkRPPmnkaZj9rzR9aGRuCRtbK12aD3vzPJiJEm2Xd2Sqpdoxt/loZIMoHRz1wQW7BsnZoFkydzKBVpHUJXV/Q6L533qWn9fyLq3k+GF0Putrkf7NJJKTn+xn7LnZWpFAibJOPAJKK+4qapEx6GiMqfLzOJiAaCFpz04NNH/IVQfKjwFtojMdUhEmPK3com9l4PktwhHacJflmhJtWoY3RbRny2CoEVWQzBSem3+8KXd7xh9QJ1Oy6Y/XAhWVSIvZbVG1lRDRQTnd96H+m8wFClw9sEUgt+ou0E0gv7zbk7EeIsbMDwPEr68IQfqUr89LDdW+Nq1WSGRWPiyTERSghbn6xenIRu/LX0H8iV+IpDB/Dkmyehz76BR/7e8LhLufDmsKTJcHZZy5E7AaIB6lHjVL3fJM3QHm4YbV9r4VHjnvbNA4x9foZVAUoiAXLnmnMuY3bnBTHqDHfhRiODlbyuxOxH9yYOAEmYb7XCDI7hTV/7IR6Cab2ml7EeDeTuZhWn8jN/PXzzg6F/XxEG7ziDFEYACr4VjyJnOAG/gn1KsEFJqwjuKBQbWi5bZzOpHAFZWmnAykN9YBYqpo5lCDphe0Qhlt9HE5MpUL5tpGXWQZ9HjXaysXdEpNp9p/JGOvdHCUnTk3j1HEVbRDwKRDacWtBhlji7Xw=
  - secure: XPLV3UyXx1qreT0TV/WKNc/gIrVZ+mAgBToslGV2bddLcr3wcTcW1+3YyN2ohEEU9TO6AVdS1LihKux6OvsozHaXGENJuo2VKrowXfaLFgy1CVBvOMvXpziM87sxjfZcQMHmDTfUOXlL0ioN9fs7h+mPW+uaym8ExNDtb+hOvas7bbcVafQ7lebHXU4f4+hGO4ZMDWnWwDtoSqwQDC7YHIim9/TVaBAZXIWGj9VYUhWlNt8abiZIobHs2Z/iqal8ZBjd9uawmxZ6Zug8Jckv/FEWmNdAvgeQDi2ssZBup3jUQNscEKOjr1jtrlZEHy01d2NI3Wp2SOAy3d1334356iTYHj4Sd0cNMKkRodAMQmYGxTfFHmrmACE+gLjvfjgcGD5eD6fHs5rn/FmB3+hq0i3KDPpW8Duxwc5rEkpq6o4a7Bml9ODpGF+JVoKBpFzfzJKVv6pUL1sVUAFcvzY6CbfHAF1yBVkd+jVuGNLjPopzjYAaRhdDbaquz8E48jaMfbxMFkRYvrEHRmYy3pGNEr3bLnCpihhXyHFnRCcWpoKIxKtnxJpMYh/sRIRNpaXfL/9AcGAC0keEX45jRO/yF4V2pm2+iOHKMDxgu7soyXKVhfhFbzL7N1s7E4dvLdEvEe7GG/ra8aJ508Vnn+2HK1FlaWiyNOhyPuP7XQ2OjVo=
